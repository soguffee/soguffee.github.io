---
title:  "[security]HashとSalt"
excerpt: "HashとSalt"

toc: true
toc_sticky: true
toc_label: "On this page"
toc_icon: "file-alt"

comments: true
categories:
  - security
tags:
  - Study
  - security
  - "2021"
last_modified_at: 2020-02-28T18:00:00-00:00

---

## ハッシュ化とは何か？
辞書ではハッシュ化とは、"何かを小片に切り刻んで"、それを"雑然としたもの"のように見せることを指すである。この定義は、コンピューターで意味するハッシュ化によくあてはまる。

暗号化におけるハッシュ関数は、どんなサイズのデータでも固定サイズのビット列にマップしてしまう数学アルゴリズムだ。この関数入力をメッセージまたは単に入力と呼ぶことができる。固定サイズ文字列の関数出力はハッシュまたはメッセージダイジェストとして知られている。OWASPで述べられているように、暗号化に使用されるハッシュ関数の主な特徴は次のとおりだ。

* ハッシュを計算するのは簡単で実用的だが、ハッシュ値だけが分かっている場合に元の入力値を復元するのは困難または不可能である。
* 特定の出力値に一致する初期入力値を作成するのは難しい。

したがって、暗号化とは対照的に、ハッシュ化は一方通行のメカニズムなのだ。ハッシュ化されたデータを"ハッシュ化されていない"元のデータに戻すことは、実質的に不可能だと思われる。

<img src="http://drive.google.com/uc?export=view&id=1viqbEqX4tcvhOTJeCBxlPnowFwLuNWIg" width="80%" height="60%" style="margin-left: auto; margin-right: auto; display: block;"> <br>

<img src="http://drive.google.com/uc?export=view&id=1_fyDRNFYvE6I8gpXG9170B0zlHNKtbts" width="80%" height="60%" style="margin-left: auto; margin-right: auto; display: block;"> <br>

一般的に使用されるハッシュ化アルゴリズムには、MD5などのメッセージダイジェスト（MDx）のほかに、SHA-1や広く使用されているSHA-256アルゴリズムを含むSHA-2ファミリなどのセキュアハッシュアルゴリズム（SHA）などがある。
一番よく使われる```SHA-256```を使用してみた。

入力：
```
python1990K00L
```


```
from hashlib import sha256
h = sha256()
h.update(b'python1990K00L')
hash = h.hexdigest()
print(hash)
```
[Python IDE](https://repl.it/languages/python "Python IDE")でPythonスクリプトを簡単に実行することが出来る。

すると、以下のような値が返されてきた。


ハッシュ（SHA-256）：
```
d1e8a70b5ccab1dc2f56bbf7e99f064a660c08e361a35751b9c483c88943d082
```

## ハッシュ関数の限界
ハッシュ化はかなり堅牢なように見える。しかし、ハッカーがサーバーに侵入してパスワードハッシュを盗んだ場合、ハッシュ関数のアーキテクチャのおかげで、ハッカーにはプレーンテキストに置き換えられないランダムなデータしか見えない。ハッカーはハッシュ関数に入力を提供して、あとで認証に使用できるハッシュを作成しなければならない。これは、サーバーで警告を発することなく、オフラインで行うことができる。

ハッカーはその後、最新のフィッシングやスプーフィング技法を用いてクリアテキストのパスワードをユーザーから盗むか、一致するハッシュが見つかるまでハッシュ関数に無作為にパスワードを入力するブルートフォースアタックを試すかのいずれかを行う。

ハッシュ関数は確定的（入力が同じであれば常に同じハッシュになる）なので、複数のユーザーが同じパスワードを使用すると、そのハッシュは同一になる。多くの人が同じハッシュにマップされると、そのハッシュが一般によく使用されるパスワードを表すサインとなってしまい、これによってハッカーはブルートフォースで侵入するために使用するパスワードの数を大幅に減らすことができる。

さらに、ハッカーはレインボーテーブルアタックを使用して、あらかじめ計算済みの膨大な量のハッシュチェインのデータベースを使用して、盗んだパスワードハッシュの入力値を探すことができる。ハッシュチェインは、初期のハッシュ値と、その値に何度も繰り返し計算を適用して得られた最終値を格納したレインボーテーブルの1行を指す。レインボーテーブルアタックではこうした多くの処理を再計算しなくてはならないので、値を格納する時点で無作為のデータを各入力に加えることでハッシュ化を強化すると、レインボーテーブルアタックを緩和できる。この方法はハッシュに```ソルト```を付加する方法として知られていて、```ソルト付きパスワードハッシュ```を生成する。