---
title:  "[Linux]grep"
excerpt: "Linux grep コマンド使い方"

toc: true
toc_sticky: true
toc_label: "On this page"
toc_icon: "file-alt"

comments: true
categories:
  - linux
tags:
  - Study
  - linux
  - japanese
  - "2020"
last_modified_at: 2020-02-18T19:22:00-00:00

---

## 1.grepコマンド
grepというコマンドはファイルの内容の中で特定の文字列を探すとき使う。
ただの文字列が一致(equal)かだけではなく、もっと多様な、そして効率的な方法にて検索機能を提供する。
これは正規表現(Regular Expression)とパターンマッチング(Pattern Matching)という方式を使用するのである。

### 1.1.正規表現式を簡単に解説
正規表現式とは、特殊な規則を持っている文字列集合を表現するための形式言語だ。
主に文字列パターンを検査したり、文字列の置換に使われる。

### 1.2.正規表現式のメーター文字


|メーター文字<br>(Meta Character) |説明 |
|:-----:|-----|
| . |1つの文字マッチ(正確に1つの文字とマッチ)|
| * |先頭文字が0回以上マッチ|
| {n} |先頭文字がn回マッチ|
| {n,m} |先頭文字がn回以上m回以下マッチ|
| [] | `[]`に含まれた文字中一つとマッチ |
| [^ ] | `[]`の中、 ^の後ろに羅列されている文字を除外 |
| [ - ] | `[]`の中、 文字範囲にある文字列マッチ|
| () | 表現式をグループ化 |
| ^ | 文字列ラインのはじめ |
| $ | 文字列ラインの最後 |
| ? | 先文字が0または1回マッチ |
| + | 先文字が1回以上マッチ |
| `|` | 論理式`OR` |

## 2.grepオプション

### 2.1.検索パターン関連のオプション

|短いオプション |長いオプション | 説明|
|:-----:|-----|-----|
| -e 検索パターン | --regexp=パターン | 検索パターンを指定する |
| -G | --basic-regexp | 検索に基本正規表現を使う |
| -E | 	--extended-regexp | 検索に拡張正規表現を使う | 
| -P | --perl-regexp | 	検索にPerl正規表現を使う |
| -f ファイル | --file=ファイル | ファイルに書かれているパターンを検索する |
| -i | --ignore-case | 大文字と小文字を区別しない |
| -w | --word-regexp | 単語全体でパターンと一致するものを検索する <br> （「単語単位で検索する」を参照）|
| -x | 	--line-regexp | 行全体がパターンと一致するものを検索する |

<br>

### 2.2.表示関連のオプション

|短いオプション |長いオプション | 説明|
|:-----:|-----|-----|
| -v | --invert-match | パターンに一致しない行を表示する |
| -s | --no-messages | エラーメッセージを表示しない |
| -q | 	--quiet <br>--silent | 	結果を表示しない（主にシェルスクリプトなどで判定用に使う） |
| -L | --files-without-match | 一致するものが含まれていないファイルのファイル名のみ表示する |
| -l | --files-with-matches	 | 一致するものが含まれているファイルのファイル名のみ表示する |
| -c | --count | 一致するものが含まれている回数のみ表示 |
| -m 回数 | --max-count=回数 | パターンが指定した回数に達したら処理を終了する |
| -o | --only-matching | 一致した箇所だけを表示する（通常は行単位で表示） |
| -n | --line-number | 行番号を併せて表示する（「行番号付きで表示する」を参照） |
| -b | --byte-offset | パターンが何文字目にあるかを併せて表示する |
| -H | --with-filename | ファイル名を併せて表示する |
| -h | --no-filename | ファイル名を表示しない（複数ファイル指定時） |
|  | --color=WHEN | 見つかったパターンを目立たせる（WHEN部分にはalways、never、autoを指定） |
| -B 行数 | --before-context=行数 | 一致した行の前の行も表示する（「前後の行も表示する」を参照） |
| -A 行数 | --after-context=行数 | 一致した行の後の行も表示する（「前後の行も表示する」を参照） |
| -C 行数,-行数 | --context=行数 | 一致した行の前後の行も表示する |

<br>

### 2.3.検索対象関連のオプション

|短いオプション |長いオプション | 説明|
|:-----:|-----|-----|
| -d ACTION | --directories=ACTION | 検索対象にディレクトリを指定した場合の動作（ACTION部分にはread、recurse、skipを指定） |
| -r | 	--recursive | ディレクトリを指定した場合はサブディレクトリ内のファイルも含めて検索する（--directories=recurse相当） |
| -R | --dereference-recursive | サブディレクトリも含めて検索、さらにシンボリックリンクの先も対象とする |
|  | 	--include=パターン | 	パターンにマッチするファイルだけを対象とする |
|  | 	--exclude=パターン | パターンにマッチするファイルは検索対象から除外する |
|  | 	--exclude-from=ファイル | 	対象から除外するファイル名のパターンをファイルから読み込む |
|  | --exclude-dir=パターン | 	パターンにマッチするディレクトリは検索対象から除外する |


## 3.コマンドの実行

*ファイルからコマンド実行*
```
$ grep [OPTION] [PATTERN] [FILE]
```

*コマンドからコマンド実行*
```
$ dmesg | grep video
```

<br>

### 3.1.単語単位で検索する

先ほどの検索で、「video」という文字列を検索しましたが、検索結果には「video」と「vboxvideo」が表示されていました。“videoという単語のみ”を検索対象としたい場合には、「-w」オプション（--word-regexp）を使用します。

*ファイルからコマンド実行*
```
$ grep -w video テキストファイル

（テキストファイルから「video」という単語が含まれている行だけを表示）
```

*コマンドからコマンド実行*
```
$ dmesg | grep -w video

（dmesgの実行結果から「video」という単語が含まれている行だけを表示）
```

<br>

### 3.2.前後の行も表示する

文字列を検索する際には、該当する行の前後も表示されていると分かりやすい場合があります。例えば、前後2行ずつ表示したい場合は、「-2」のように数字で指定します。これは「-C（--context=）」オプションと同じです。

*ファイルからコマンド実行*
```
$ grep -2 検索文字列 テキストファイル

（テキストファイルから文字列を検索し、検索結果の前後2行も表示）
```

*コマンドからコマンド実行*
```
$ dmesg | grep -w -2 video

（dmesgの実行結果からvideoという単語（-wオプション）が含まれる行を前後2行含めて表示）
```

<br>

### 3.3.行番号付きで表示する

grepコマンドでの検索結果に行番号を付けて表示したい場合は、「-n」オプション（--line-number）を使用します。「行番号:～」のように表示されますが、前後の行も併せて表示している場合は、前後の行は「行番号-～」のように「-」記号で、該当する行は「:」記号で示されます。

*ファイルからコマンド実行*
```
$ grep -n 検索文字列 テキストファイル

（テキストファイルから文字列を検索し、行番号と共に表示）
```

*コマンドからコマンド実行*
```
$ dmesg | grep -w -2 video

（dmesgの実行結果からvideoという単語（-wオプション）が含まれる行を前後2行含めて（-2）行番号付き（-n）で表示）
```

<br>

■参考ページ
